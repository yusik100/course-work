# Library Management System

## Курсова робота з дисципліни "Бази даних"

Backend-додаток для автоматизації роботи бібліотеки. Система реалізує повний цикл управління бібліотечним фондом: облік фізичних копій книг, реєстрацію читачів, транзакційний механізм видачі літератури та генерацію аналітичних звітів.

Проєкт побудований за принципом **Layered Architecture** і надає доступ до даних через **REST API** зі зручною документацією.

## Виконала: Костанді Юлія ІМ-41

---

## Технологічний стек

* **Мова:** Python 3.10+
* **Web-фреймворк:** **FastAPI**
* **Сервер:** **Uvicorn**
* **База даних:** PostgreSQL 15
* **ORM:** SQLAlchemy
* **Міграції:** Alembic
* **Контейнеризація:** Docker & Docker Compose
* **Тестування:** Pytest

---

## Інструкція з запуску

### Крок 1. Клонування репозиторію

```bash
git clone https://github.com/yusik100/course-work.git
cd library_project

```

### Крок 2. Налаштування змінних середовища

Створіть файл конфігурації `.env` на основі прикладу:

```bash
cp .env.example .env

```

### Крок 3. Запуск контейнерів

Підніміть інфраструктуру (Web API + база даних):

```bash
docker-compose up -d --build

```

### Крок 4. Наповнення даними

Виконайте наступну команду **всередині контейнера** для генерації тестових даних (Seed).
Скрипт автоматично створить ~30 читачів, 20 книг, 60 копій та історію видач.

```bash
docker exec -it library_app_container python seed.py

```

---

## Доступ до системи (API)

Після запуску контейнерів веб-інтерфейс доступний у браузері.

**Інтерактивна документація (Swagger UI):**
**[http://localhost:8000/docs](http://localhost:8000/docs)**

Тут можна:

* Переглянути список усіх доступних запитів (GET, POST, DELETE).
* Протестувати роботу API прямо в браузері (кнопка "Try it out").
* Подивитися схеми даних (JSON).

---

### Альтернатива: Консольна демонстрація

Якщо ви хочете подивитися роботу скриптів без веб-інтерфейсу, запустіть файл `demo.py`:

```bash
docker exec -it library_app_container python demo.py

```

Цей сценарій виведе аналітичні звіти та продемонструє процес видачі/повернення книги в консолі.

---

## Тестування

Проєкт покритий автоматичними тестами, які перевіряють бізнес-логіку, коректність SQL-запитів та роботу транзакцій.

**Запуск усіх тестів:**

```bash
docker exec -it library_app_container pytest

```

**Запуск окремого файлу з тестами:**

```bash
docker exec -it library_app_container pytest tests/unit/test_models.py

```

**Запуск тесту за назвою:**

```bash
docker exec -it library_app_container pytest -v -k "lifecycle"

```

---

## Аналітичні запити

У `docs/queries.md` детально описані та пояснені SQL-запити. Система використовує оптимізовані SQL-запити через ORM:

* **Рейтинг читачів:** Використання віконної функції `RANK()` для побудови справедливого рейтингу активності (врахування однакових місць).
* **Звіт про боржників:** Фільтрація за датою (`due_date < CURRENT_DATE`) та обчислення прострочення.
* **Популярність жанрів:** Використання `JOIN` чотирьох таблиць та агрегації `COUNT/GROUP BY`.


## Структура проєкту

```bash
.
├── src/
│   ├── main.py          # Точка входу (FastAPI додаток)
│   ├── database.py      # Підключення до БД (Session)
│   ├── models.py        # SQLAlchemy моделі таблиць
│   ├── services.py      # Бізнес-логіка (CRUD операції)
│   └── queries.py       # Аналітичні запити (Звіти)
├── alembic/             # Міграції бази даних
├── docs/                # Додаткова документація
├── tests/               # Unit та Integration тести
├── docker-compose.yml   # Конфігурація Docker
├── Dockerfile           # Інструкція збірки образу
├── demo.py              # Сценарій демонстрації (Console)
├── seed.py              # Генератор тестових даних
└── README.md            # Документація

```